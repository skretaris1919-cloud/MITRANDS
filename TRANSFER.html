<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Form Tes Pembayaran Santri</title>
  <!-- Client Key Sandbox dari Midtrans -->
  <script src="https://app.sandbox.midtrans.com/snap/snap.js" data-client-key="Mid-client-l2QYZNGl7qkb35nc"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 400px; margin: auto; }
    input, button { width: 100%; padding: 10px; margin: 8px 0; font-size: 16px; }
    button { background-color: #2e7d32; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Form Tes Pembayaran Santri</h2>
  <form id="formTes">
    <input type="text" id="nama" placeholder="Nama Pengirim" required>
    <input type="text" id="wa" placeholder="Nomor WhatsApp" required>
    <input type="text" id="idSantri" placeholder="ID Santri" required>
    <input type="number" id="nominal" placeholder="Nominal (Rp)" required>
    <button type="submit">Bayar Tes</button>
  </form>

  <script>
    document.getElementById('formTes').addEventListener('submit', async function(e) {
      e.preventDefault();

      const nama = document.getElementById('nama').value.trim();
      const wa = document.getElementById('wa').value.trim();
      const idSantri = document.getElementById('idSantri').value.trim();
      const nominal = parseInt(document.getElementById('nominal').value);
      const order_id = `${idSantri}_${nama}_${wa}`.replace(/\s+/g, '');

      const url = `https://script.google.com/macros/s/AKfycbytuFjLYwyqsYJkG_Nfbr-XzyC4RtQbgPLdiGOy7N5N1PmyESsAw71FiUthO2u1566y/exec?order_id=${order_id}&nominal=${nominal}&nama=${encodeURIComponent(nama)}&wa=${wa}`;
      try {
        const res = await fetch(url);
        const result = await res.json();
        if (result.token) {
          snap.pay(result.token); // Munculkan Snap UI
        } else {
          alert("Gagal mendapatkan token Snap.");
        }
      } catch (err) {
        alert("Gagal terhubung ke server. Cek koneksi atau URL Apps Script.");
        console.error(err);
      }
    });
  </script>
</body>
</html>
